{% extends "base.html" %}

{% block title %}طلبات السحب - الإدارة{% endblock %}

{% block content %}
<div class="container" style="padding: 3rem 0;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>
            <i class="fas fa-money-bill-wave"></i> طلبات السحب
        </h1>
    </div>

    <!-- Filters -->
    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
        <a href="{{ url_for('admin.withdrawal_requests', status='all') }}"
            class="btn btn-{% if current_filter == 'all' %}primary{% else %}secondary{% endif %}">
            الكل
        </a>
        <a href="{{ url_for('admin.withdrawal_requests', status='pending') }}"
            class="btn btn-{% if current_filter == 'pending' %}warning{% else %}secondary{% endif %}"
            style="position: relative;">
            قيد الانتظار
            {% if pending_count > 0 %}
            <span
                style="position: absolute; top: -5px; right: -5px; background: var(--gold); color: black; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">
                {{ pending_count }}
            </span>
            {% endif %}
        </a>
        <a href="{{ url_for('admin.withdrawal_requests', status='approved') }}"
            class="btn btn-{% if current_filter == 'approved' %}success{% else %}secondary{% endif %}">
            معتمد
        </a>
        <a href="{{ url_for('admin.withdrawal_requests', status='rejected') }}"
            class="btn btn-{% if current_filter == 'rejected' %}danger{% else %}secondary{% endif %}">
            مرفوض
        </a>
    </div>

    <!-- Requests List -->
    <div class="card">
        <div class="card-body">
            {% if requests %}
            <div style="overflow-x: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>المستخدم</th>
                            <th>المبلغ</th>
                            <th>الطريقة</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in requests %}
                        <tr>
                            <td>
                                <small>{{ req.request_date.strftime('%Y-%m-%d') }}</small><br>
                                <small class="text-muted">{{ req.request_date.strftime('%H:%M') }}</small>
                            </td>
                            <td>
                                <strong>{{ req.user.name }}</strong><br>
                                <small class="text-muted">{{ req.user.email }}</small>
                            </td>
                            <td class="text-left">
                                <strong style="color: var(--gold);">{{ "{:,.0f}".format(req.amount) }} جنيه</strong>
                            </td>
                            <td>{{ req.payment_method_arabic }}</td>
                            <td>
                                <span
                                    class="badge badge-{% if req.status == 'pending' %}warning{% elif req.status == 'approved' %}success{% elif req.status == 'rejected' %}danger{% else %}secondary{% endif %}">
                                    {{ req.status_arabic }}
                                </span>
                            </td>
                            <td>
                                <a href="{{ url_for('admin.withdrawal_request_detail', request_id=req.id) }}"
                                    class="btn btn-secondary btn-sm">
                                    <i class="fas fa-eye"></i> عرض
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center text-muted" style="padding: 3rem;">
                <i class="fas fa-inbox" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                <p>لا توجد طلبات</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 0.75rem;
        text-align: right;
        border-bottom: 1px solid rgba(212, 175, 55, 0.1);
    }

    .table thead th {
        font-weight: 600;
        color: var(--gold);
        border-bottom: 2px solid var(--gold);
    }

    .table tbody tr:hover {
        background: rgba(212, 175, 55, 0.05);
    }
</style>
{% endblock %}