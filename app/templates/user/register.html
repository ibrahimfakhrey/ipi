{% extends "base.html" %}

{% block title %}إنشاء حساب{% endblock %}

{% block content %}
<div class="container" style="max-width: 500px; margin-top: 4rem; margin-bottom: 4rem;">
    <div class="card">
        <div class="card-header">
            <h2 class="card-title text-center">
                <i class="fas fa-user-plus"></i> إنشاء حساب جديد
            </h2>
        </div>

        <div class="card-body">
            <form method="POST" action="{{ url_for('auth.register') }}">
                <div class="form-group">
                    <label for="name" class="form-label">الاسم الكامل</label>
                    <input type="text" id="name" name="name" class="form-control" placeholder="أحمد محمد" required>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">البريد الإلكتروني</label>
                    <input type="email" id="email" name="email" class="form-control" placeholder="example@email.com"
                        required>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">كلمة المرور</label>
                    <input type="password" id="password" name="password" class="form-control" placeholder="••••••••"
                        minlength="6" required>
                    <small class="text-muted">يجب أن تكون 6 أحرف على الأقل</small>
                </div>

                <div class="form-group">
                    <label for="confirm_password" class="form-label">تأكيد كلمة المرور</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-control"
                        placeholder="••••••••" required>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> إنشاء الحساب
                </button>

                <!-- Divider -->
                <div style="text-align: center; margin: 1.5rem 0; position: relative;">
                    <hr style="border-top: 1px solid rgba(212, 175, 55, 0.2);">
                    <span
                        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--background-navy); padding: 0 1rem; color: var(--text-muted);">أو</span>
                </div>

                <!-- Google Sign-In Button -->
                <div id="g_id_onload"
                    data-client_id="7685982458-7hdh31pb18cgcaiedkd9dg9onidefvid.apps.googleusercontent.com"
                    data-context="signup" data-ux_mode="popup" data-callback="handleGoogleSignIn"
                    data-auto_prompt="false">
                </div>

                <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="filled_black"
                    data-text="signup_with" data-size="large" data-logo_alignment="left" data-width="100%"
                    style="width: 100%; display: flex; justify-content: center;">
                </div>
            </form>
        </div>

        <div class="card-footer text-center">
            <p>لديك حساب بالفعل؟ <a href="{{ url_for('auth.login') }}">تسجيل الدخول</a></p>
        </div>
    </div>
</div>

<!-- Google Sign-In Library -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
    function handleGoogleSignIn(response) {
        // Send the credential (ID token) to our backend
        fetch('/auth/google/callback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                credential: response.credential
            })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // Redirect to dashboard or intended page
                    window.location.href = data.redirect_url || '/user/dashboard';
                } else {
                    alert(data.message || 'حدث خطأ أثناء التسجيل');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء التسجيل عبر Google');
            });
    }
</script>
{% endblock %}