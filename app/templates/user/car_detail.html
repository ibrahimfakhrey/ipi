{% extends "base.html" %}

{% block title %}{{ car.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/landing.css') }}">
{% endblock %}

{% block content %}
<div style="padding: 3rem 0;">
    <div class="container" style="max-width: 1000px;">
        <div class="grid grid-2" style="gap: 2rem;">
            <!-- Image -->
            <div>
                {% if car.image and car.image != 'default_car.jpg' %}
                    <img src="{{ url_for('static', filename='images/cars/' + car.image) }}" 
                         alt="{{ car.title }}"
                         style="width: 100%; border-radius: 1rem; box-shadow: var(--shadow-lg); object-fit: cover;">
                {% else %}
                    <div style="width: 100%; aspect-ratio: 16/9; background: linear-gradient(135deg, var(--secondary-navy) 0%, var(--background-navy) 100%); border-radius: 1rem; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-lg);">
                        <i class="fas fa-car" style="font-size: 5rem; color: var(--text-muted);"></i>
                    </div>
                {% endif %}
                <div class="card" style="margin-top: 1.5rem;">
                    <h3 class="text-gold" style="margin-bottom: 1rem;">معلومات الاستثمار</h3>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>سعر الحصة الواحدة:</span>
                            <strong class="text-gold">{{ "{:,.0f}".format(car.share_price) }} جنيه</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>الحصص المتاحة:</span>
                            <strong>{{ car.shares_available }} / {{ car.total_shares }}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>العائد الشهري:</span>
                            <strong class="text-success">{{ "{:,.0f}".format(car.monthly_rent) }} جنيه</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>العائد الشهري لكل حصة:</span>
                            <strong class="text-success">{{ "{:,.0f}".format(car.monthly_rent / car.total_shares) }} جنيه</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>عدد المستثمرين:</span>
                            <strong>{{ investors_count }}</strong>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Details -->
            <div>
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <h1 style="margin-bottom: 0;">{{ car.title }}</h1>
                    <span class="badge badge-{{ 'success' if car.status == 'جديد' else 'warning' if car.status == 'متاح' else 'danger' }}">
                        {{ car.status }}
                    </span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 2rem; color: var(--text-muted);">
                    <i class="fas fa-map-marker-alt"></i>
                    {{ car.location }}
                </div>
                <div class="card" style="margin-bottom: 2rem;">
                    <h2 class="text-gold" style="font-size: 2.5rem; margin-bottom: 0.5rem;">
                        {{ "{:,.0f}".format(car.total_price) }} جنيه
                    </h2>
                    <p class="text-muted">السعر الإجمالي للسيارة</p>
                    <div class="progress-bar-container" style="margin: 1.5rem 0;">
                        <div class="progress-bar" data-percentage="{{ car.completion_percentage }}" style="width: 0%"></div>
                    </div>
                    <p class="text-center">تم بيع {{ car.completion_percentage|round(1) }}% من الحصص</p>
                </div>
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 class="text-gold">الوصف</h3>
                    <p style="line-height: 1.8; white-space: pre-wrap;">{{ car.description }}</p>
                </div>
                {% if current_user.is_authenticated and not current_user.is_admin and car.shares_available > 0 and not car.is_closed %}
                    <a href="{{ url_for('user_views.buy_car_shares', car_id=car.id) }}" 
                       class="btn btn-primary btn-lg" style="width: 100%;">
                        <i class="fas fa-shopping-cart"></i> شراء حصص الآن
                    </a>
                {% elif not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.login') }}" 
                       class="btn btn-primary btn-lg" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> سجل دخولك للاستثمار
                    </a>
                {% elif car.shares_available == 0 or car.is_closed %}
                    <button class="btn btn-secondary btn-lg" style="width: 100%;" disabled>
                        <i class="fas fa-lock"></i> تم بيع جميع الحصص
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
