{% extends "base.html" %}

{% block title %}لوحة التحكم - المستثمر{% endblock %}

{% block content %}
<div class="container" style="padding: 3rem 0;">
    <h1 style="margin-bottom: 2rem;">
        <i class="fas fa-chart-line"></i> لوحة التحكم
    </h1>
    
    <!-- Stats Cards -->
    <div class="grid grid-4" style="margin-bottom: 3rem;">
        <div class="card text-center">
            <div class="stat-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">
                <i class="fas fa-wallet"></i>
            </div>
            <div class="stat-number" style="font-size: 2rem;">{{ "{:,.0f}".format(current_user.wallet_balance) }}</div>
            <div class="stat-label">رصيد المحفظة (جنيه)</div>
        </div>
        
        <div class="card text-center">
            <div class="stat-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">
                <i class="fas fa-coins"></i>
            </div>
            <div class="stat-number" style="font-size: 2rem;">{{ "{:,.0f}".format(total_invested) }}</div>
            <div class="stat-label">إجمالي الاستثمار</div>
        </div>
        
        <div class="card text-center">
            <div class="stat-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">
                <i class="fas fa-hand-holding-usd"></i>
            </div>
            <div class="stat-number" style="font-size: 2rem;">{{ "{:,.0f}".format(expected_monthly) }}</div>
            <div class="stat-label">الدخل الشهري المتوقع</div>
        </div>
        
        <div class="card text-center">
            <div class="stat-icon" style="font-size: 2rem; margin-bottom: 0.5rem;">
                <i class="fas fa-building"></i>
            </div>
            <div class="stat-number" style="font-size: 2rem;">{{ investments|length }}</div>
            <div class="stat-label">عدد الاستثمارات</div>
        </div>
    </div>
    
    <!-- Referral Rewards Card -->
    {% if current_user.rewards_balance > 0 %}
    <div class="alert alert-warning" style="margin-bottom: 2rem;">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h5 style="margin: 0; color: #D4AF37;">
                    <i class="fas fa-gift"></i> لديك مكافآت إحالة بقيمة {{ "{:,.2f}".format(current_user.rewards_balance) }} جنيه
                </h5>
                <small style="color: #666;">يتم صرفها بواسطة الإدارة. راجع شجرة الإحالات لمزيد من التفاصيل.</small>
            </div>
            <div class="col-md-4 text-end">
                <a href="{{ url_for('user_views.my_referrals') }}" class="btn btn-sm" style="background: #D4AF37; color: white;">
                    <i class="fas fa-tree"></i> شجرة الإحالات
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Quick Actions -->
    <div class="grid grid-3" style="margin-bottom: 3rem;">
        <a href="{{ url_for('main.market') }}" class="btn btn-primary btn-lg" style="text-decoration: none;">
            <i class="fas fa-search"></i> تصفح الفرص
        </a>
        <a href="{{ url_for('user_views.wallet') }}" class="btn btn-secondary btn-lg" style="text-decoration: none;">
            <i class="fas fa-wallet"></i> المحفظة
        </a>
        <a href="{{ url_for('user_views.my_investments') }}" class="btn btn-secondary btn-lg" style="text-decoration: none;">
            <i class="fas fa-chart-pie"></i> استثماراتي
        </a>
    </div>
    
    <!-- Referral Section -->
    <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #D4AF37 0%, #C19B2E 100%); color: white;">
        <div style="padding: 1.5rem;">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 style="margin: 0 0 0.5rem 0; color: white;">
                        <i class="fas fa-users"></i> برنامج الإحالة
                    </h4>
                    <p style="margin: 0; opacity: 0.9;">
                        احصل على مكافآت عند إحالة مستثمرين جدد. شارك روابط الإحالة واكسب من استثماراتهم!
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="{{ url_for('user_views.my_referrals') }}" class="btn btn-light btn-lg">
                        <i class="fas fa-share-alt"></i> روابط الإحالة
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Investments -->
    <div class="card" style="margin-bottom: 3rem;">
        <div class="card-header">
            <h2 class="card-title">استثماراتي الحالية</h2>
        </div>
        <div class="card-body">
            {% if investments %}
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>العقار</th>
                                <th>عدد الحصص</th>
                                <th>المبلغ المستثمر</th>
                                <th>الدخل الشهري</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for investment in investments %}
                            <tr>
                                <td>
                                    <strong>{{ investment.apartment.title }}</strong><br>
                                    <small class="text-muted">{{ investment.apartment.location }}</small>
                                </td>
                                <td>{{ investment.shares_count }} حصة</td>
                                <td>{{ "{:,.0f}".format(investment.total_invested) }} جنيه</td>
                                <td class="text-success">{{ "{:,.0f}".format(investment.monthly_income) }} جنيه</td>
                                <td><span class="badge badge-{{ 'success' if investment.apartment.is_closed else 'warning' }}">
                                    {{ investment.apartment.status }}
                                </span></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center" style="padding: 2rem;">
                    <i class="fas fa-inbox" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                    <p>لا توجد استثمارات حالياً</p>
                    <a href="{{ url_for('main.market') }}" class="btn btn-primary">ابدأ الاستثمار</a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Recent Transactions -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">آخر العمليات</h2>
        </div>
        <div class="card-body">
            {% if recent_transactions %}
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>النوع</th>
                                <th>المبلغ</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in recent_transactions %}
                            <tr>
                                <td>{{ transaction.type_arabic }}</td>
                                <td class="{{ 'text-success' if transaction.amount > 0 else 'text-error' }}">
                                    {{ "{:+,.0f}".format(transaction.amount) }} جنيه
                                </td>
                                <td>{{ transaction.date.strftime('%Y-%m-%d %H:%M') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <div class="text-center" style="margin-top: 1rem;">
                    <a href="{{ url_for('user_views.wallet') }}" class="btn btn-secondary">عرض جميع العمليات</a>
                </div>
            {% else %}
                <p class="text-center text-muted">لا توجد عمليات حتى الآن</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
